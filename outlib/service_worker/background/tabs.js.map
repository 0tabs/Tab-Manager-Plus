{"version":3,"sources":["../../../lib/service_worker/background/tabs.js"],"names":["browser","tabs","onCreated","removeListener","tabAdded","onUpdated","tabCountChanged","onRemoved","onReplaced","onDetached","onAttached","onActivated","tabActiveChanged","onMoved","checkTabCreate","checkTabUpdate","checkTabRemove","checkTabDetached","checkTabAttached","checkTabMoved","addListener","setupTabListeners","i","length","discarded","discard","id","catch","e","console","error","log","message","discardTabs","remove","closeTabs","windowId","t","move","index","update","pinned","moveTabsToWindow","tab","tabId","windows","focused","then","active","bind","focusOnTabAndWindow","run","getLocalStorage","badge","query","result","count","action","setBadgeText","text","setBadgeBackgroundColor","color","toRemove","globalTabsActive","found","j","push","splice","updateTabCount","tabLimit","TAB_ID_NONE","currentWindow","tabCount","createWindowWithTabs","incognito","updateTabCountDebounce","checkWindow","tabid","changeinfo","removeinfo","isWindowClosing","detachinfo","oldWindowId","attachinfo","newWindowId","moveinfo","chrome","focusOnTabAndWindowDelayed","JSON","parse","stringify","setTimeout","lastActive","shift"],"mappings":"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","file":"tabs.js","sourcesContent":["ï»¿var browser = browser || chrome;\r\n\r\nasync function setupTabListeners() {\r\n\tbrowser.tabs.onCreated.removeListener(tabAdded);\r\n\tbrowser.tabs.onUpdated.removeListener(tabCountChanged);\r\n\tbrowser.tabs.onRemoved.removeListener(tabCountChanged);\r\n\tbrowser.tabs.onReplaced.removeListener(tabCountChanged);\r\n\tbrowser.tabs.onDetached.removeListener(tabCountChanged);\r\n\tbrowser.tabs.onAttached.removeListener(tabCountChanged);\r\n\tbrowser.tabs.onActivated.removeListener(tabActiveChanged);\r\n\tbrowser.tabs.onMoved.removeListener(tabCountChanged);\r\n\r\n\tbrowser.tabs.onCreated.removeListener(checkTabCreate);\r\n\tbrowser.tabs.onUpdated.removeListener(checkTabUpdate);\r\n\tbrowser.tabs.onRemoved.removeListener(checkTabRemove);\r\n\tbrowser.tabs.onDetached.removeListener(checkTabDetached);\r\n\tbrowser.tabs.onAttached.removeListener(checkTabAttached);\r\n\tbrowser.tabs.onMoved.removeListener(checkTabMoved);\r\n\r\n\tbrowser.tabs.onCreated.addListener(tabAdded);\r\n\tbrowser.tabs.onUpdated.addListener(tabCountChanged);\r\n\tbrowser.tabs.onRemoved.addListener(tabCountChanged);\r\n\tbrowser.tabs.onReplaced.addListener(tabCountChanged);\r\n\tbrowser.tabs.onDetached.addListener(tabCountChanged);\r\n\tbrowser.tabs.onAttached.addListener(tabCountChanged);\r\n\tbrowser.tabs.onActivated.addListener(tabActiveChanged);\r\n\tbrowser.tabs.onMoved.addListener(tabCountChanged);\r\n\r\n\tbrowser.tabs.onCreated.addListener(checkTabCreate); // 1, tab\r\n\tbrowser.tabs.onUpdated.addListener(checkTabUpdate); // 3, tabid, changeinfo, tab\r\n\tbrowser.tabs.onRemoved.addListener(checkTabRemove); // 2, tabid, removeinfo\r\n\tbrowser.tabs.onDetached.addListener(checkTabDetached); // 2, tabid, detachinfo\r\n\tbrowser.tabs.onAttached.addListener(checkTabAttached); // 2, tabid, attachinfo\r\n\tbrowser.tabs.onMoved.addListener(checkTabMoved); // 2, tabid, moveinfo\r\n}\r\n\r\nasync function discardTabs(tabs) {\r\n\tfor (var i = 0; i < tabs.length; i++) {\r\n\t\tif (!tabs[i].discarded) {\r\n\t\t\tbrowser.tabs.discard(tabs[i].id).catch(function (e) {\r\n\t\t\t\tconsole.error(e);\r\n\t\t\t\tconsole.log(e.message);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n}\r\n\r\nasync function closeTabs(tabs) {\r\n\tfor (var i = 0; i < tabs.length; i++) {\r\n\t\tawait browser.tabs.remove(tabs[i].id);\r\n\t}\r\n}\r\n\r\nasync function moveTabsToWindow(windowId, tabs) {\r\n\tfor (var i = 0; i < tabs.length; i++) {\r\n\t\tvar t = tabs[i];\r\n\t\tawait browser.tabs.move(t.id, {windowId: windowId, index: -1});\r\n\t\tawait browser.tabs.update(t.id, {pinned: t.pinned});\r\n\t}\r\n}\r\n\r\nfunction focusOnTabAndWindowDelayed(tab) {\r\n\tvar tab = JSON.parse(JSON.stringify(tab));\r\n\tsetTimeout(focusOnTabAndWindow.bind(this, tab), 125);\r\n}\r\n\r\nasync function focusOnTabAndWindow(tab) {\r\n\tvar windowId = tab.windowId;\r\n\tvar tabId;\r\n\tif (!!tab.tabId) {\r\n\t\ttabId = tab.tabId;\r\n\t} else {\r\n\t\ttabId = tab.id;\r\n\t}\r\n\r\n\tbrowser.windows.update(windowId, {focused: true}).then(function (tabId, windowId) {\r\n\t\tbrowser.tabs.update(tabId, {active: true}).then(function (tabId, windowId) {\r\n\t\t\ttabActiveChanged({tabId: tabId, windowId: windowId});\r\n\t\t}.bind(this, tabId, windowId));\r\n\t}.bind(this, tabId, windowId));\r\n}\r\n\r\nasync function updateTabCount() {\r\n\tvar run = true;\r\n\r\n\tvar badge = await getLocalStorage(\"badge\", true);\r\n\tif (!badge) run = false;\r\n\r\n\tif (run) {\r\n\t\tvar result = await browser.tabs.query({});\r\n\t\tvar count = 0;\r\n\t\tif (!!result && !!result.length) {\r\n\t\t\tcount = result.length;\r\n\t\t}\r\n\t\tawait browser.action.setBadgeText({text: count + \"\"});\r\n\t\tawait browser.action.setBadgeBackgroundColor({color: \"purple\"});\r\n\t\tvar toRemove = [];\r\n\t\tif (!!globalTabsActive) {\r\n\t\t\tfor (var i = 0; i < globalTabsActive.length; i++) {\r\n\t\t\t\tvar t = globalTabsActive[i];\r\n\t\t\t\tvar found = false;\r\n\t\t\t\tif (!!result && !!result.length) {\r\n\t\t\t\t\tfor (var j = 0; j < result.length; j++) {\r\n\t\t\t\t\t\tif (result[j].id == t.tabId) found = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t;\r\n\t\t\t\t}\r\n\t\t\t\tif (!found) toRemove.push(i);\r\n\t\t\t}\r\n\t\t\t;\r\n\t\t}\r\n\t\t// console.log(\"to remove\", toRemove);\r\n\t\tfor (var i = toRemove.length - 1; i >= 0; i--) {\r\n\t\t\t// console.log(\"removing\", toRemove[i]);\r\n\t\t\tif (!!globalTabsActive && globalTabsActive.length > 0) {\r\n\t\t\t\tif (!!globalTabsActive[toRemove[i]]) globalTabsActive.splice(toRemove[i], 1);\r\n\t\t\t}\r\n\t\t}\r\n\t\t;\r\n\t} else {\r\n\t\tawait browser.action.setBadgeText({text: \"\"});\r\n\t}\r\n}\r\n\r\nfunction tabCountChanged() {\r\n\tupdateTabCountDebounce();\r\n}\r\n\r\nasync function tabAdded(tab) {\r\n\tvar tabLimit = await getLocalStorage(\"tabLimit\", 0);\r\n\tif (tabLimit > 0) {\r\n\t\tif (tab.id != browser.tabs.TAB_ID_NONE) {\r\n\t\t\tvar tabCount = await browser.tabs.query({currentWindow: true});\r\n\t\t\tif (tabCount.length > tabLimit) {\r\n\t\t\t\tawait createWindowWithTabs([tab], tab.incognito);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tupdateTabCountDebounce();\r\n}\r\n\r\nfunction tabActiveChanged(tab) {\r\n\tif (!!tab && !!tab.tabId) {\r\n\t\tif (!globalTabsActive) globalTabsActive = [];\r\n\t\tif (!!globalTabsActive && globalTabsActive.length > 0) {\r\n\t\t\tvar lastActive = globalTabsActive[globalTabsActive.length - 1];\r\n\t\t\tif (!!lastActive && lastActive.tabId == tab.tabId && lastActive.windowId == tab.windowId) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\twhile (globalTabsActive.length > 20) {\r\n\t\t\tglobalTabsActive.shift();\r\n\t\t}\r\n\t\tfor (var i = globalTabsActive.length - 1; i >= 0; i--) {\r\n\t\t\tif (globalTabsActive[i].tabId == tab.tabId) {\r\n\t\t\t\tglobalTabsActive.splice(i, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t\tglobalTabsActive.push(tab);\r\n\t}\r\n\tupdateTabCountDebounce();\r\n}\r\n\r\nasync function checkTabCreate(tab) {\r\n\tawait checkWindow(tab.windowId);\r\n}\r\n\r\nasync function checkTabUpdate(tabid, changeinfo, tab) {\r\n\tawait checkWindow(tab.windowId);\r\n}\r\n\r\nasync function checkTabRemove(tabid, removeinfo) {\r\n\tif (removeinfo.isWindowClosing) return;\r\n\tawait checkWindow(removeinfo.windowId);\r\n}\r\n\r\nasync function checkTabDetached(tabid, detachinfo) {\r\n\tawait checkWindow(detachinfo.oldWindowId);\r\n}\r\n\r\nasync function checkTabAttached(tabid, attachinfo) {\r\n\tawait checkWindow(attachinfo.newWindowId);\r\n}\r\n\r\nasync function checkTabMoved(tabid, moveinfo) {\r\n\tawait checkWindow(moveinfo.windowId);\r\n}"]}