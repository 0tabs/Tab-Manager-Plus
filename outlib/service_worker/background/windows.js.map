{"version":3,"sources":["../../../lib/service_worker/background/windows.js"],"names":["browser","windows","onFocusChanged","removeListener","windowFocus","onCreated","windowCreated","onRemoved","windowRemoved","addListener","setupWindowListeners","tabs","isIncognito","pinnedIndex","firstTab","shift","t","i","length","push","id","firstPinned","pinned","create","tabId","incognito","w","update","oldTabId","get","oldTab","tabPinned","movedTabs","move","windowId","index","newTab","focused","createWindowWithTabs","window","customName","name","color","whitelistWindow","navigator","userAgent","search","whitelistTab","filteredWindow","Object","keys","windowsInfo","filter","key","includes","reduce","obj","left","top","width","height","type","catch","error","console","log","message","newWindow","emptyTab","url","tabCreated","remove","setWindowName","setWindowColor","createWindowWithSessionTabs","focusOnWindow","getLocalStorage","hideWindows","permissions","contains","result","chrome","system","display","getInfo","displaylayouts","globalDisplayInfo","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_iterator","Symbol","iterator","_step","next","done","displaylayout","value","bounds","return","getAll","populate","monitor","a","is_in_bounds","bind","windowAge","Array","indexOf","splice","unshift","setLocalStorage","windowActive","setTimeout","cleanupDebounce","storage","local","names","windowNames","colors","windowColors","hashes","windowHashes","newHash","hashcode","checkWindow","focusOnWindowDelayed","urls","sort","hash","code","stringHashcode"],"mappings":";;;sDAEA;AAAA;AAAA;AAAA;AAAA;AACCA,cAAQC,OAAR,CAAgBC,cAAhB,CAA+BC,cAA/B,CAA8CC,WAA9C;AACAJ,cAAQC,OAAR,CAAgBI,SAAhB,CAA0BF,cAA1B,CAAyCG,aAAzC;AACAN,cAAQC,OAAR,CAAgBM,SAAhB,CAA0BJ,cAA1B,CAAyCK,aAAzC;;AAEAR,cAAQC,OAAR,CAAgBC,cAAhB,CAA+BO,WAA/B,CAA2CL,WAA3C;AACAJ,cAAQC,OAAR,CAAgBI,SAAhB,CAA0BI,WAA1B,CAAsCH,aAAtC;AACAN,cAAQC,OAAR,CAAgBM,SAAhB,CAA0BE,WAA1B,CAAsCD,aAAtC;;AAPD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,E;;iBAAeE,oB;;;;;;uDAUf,kBAAoCC,IAApC,EAA0CC,WAA1C;AAAA;;AAAA;AAAA;AAAA;AAAA;AACKC,iBADL,GACmB,CADnB;AAEKC,cAFL,GAEgBH,KAAKI,KAAL,EAFhB;AAGKC,OAHL,GAGS,EAHT;;AAIC,WAASC,CAAT,GAAa,CAAb,EAAgBA,IAAIN,KAAKO,MAAzB,EAAiCD,GAAjC,EAAsC;AACrCD,SAAEG,IAAF,CAAOR,KAAKM,CAAL,EAAQG,EAAf;AACA;AACD;;AAEIC,iBATL,GASmBP,SAASQ,MAT5B;AAAA;AAAA,aAUetB,QAAQC,OAAR,CAAgBsB,MAAhB,CAAuB,EAACC,OAAOV,SAASM,EAAjB,EAAqBK,WAAW,CAAC,CAACb,WAAlC,EAAvB,CAVf;;AAAA;AAUKc,OAVL;;AAAA,WAWKL,WAXL;AAAA;AAAA;AAAA;;AAAA;AAAA,aAYQrB,QAAQW,IAAR,CAAagB,MAAb,CAAoBD,EAAEf,IAAF,CAAO,CAAP,EAAUS,EAA9B,EAAkC,EAACE,QAAQD,WAAT,EAAlC,CAZR;;AAAA;AAaER;;AAbF;AAAA,YAgBKG,EAAEE,MAAF,GAAW,CAhBhB;AAAA;AAAA;AAAA;;AAiBMD,OAjBN,GAiBU,CAjBV;AAAA;AAAA;AAAA;AAAA;AAAA,mBAkBuBD,CAlBvB;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAkBWY,cAlBX;;AAmBGX;AAnBH;AAAA,aAoBsBjB,QAAQW,IAAR,CAAakB,GAAb,CAAiBD,QAAjB,CApBtB;;AAAA;AAoBOE,YApBP;AAqBOC,eArBP,GAqBmBD,OAAOR,MArB1B;AAsBOU,eAtBP,GAsBmB,EAtBnB;;AAAA,UAuBQD,SAvBR;AAAA;AAAA;AAAA;;AAAA;AAAA,aAwBsB/B,QAAQW,IAAR,CAAasB,IAAb,CAAkBL,QAAlB,EAA4B,EAACM,UAAUR,EAAEN,EAAb,EAAiBe,OAAO,CAAC,CAAzB,EAA5B,CAxBtB;;AAAA;AAwBIH,eAxBJ;AAAA;AAAA;;AAAA;AAAA;AAAA,aA0BsBhC,QAAQW,IAAR,CAAasB,IAAb,CAAkBL,QAAlB,EAA4B,EAACM,UAAUR,EAAEN,EAAb,EAAiBe,OAAOtB,aAAxB,EAA5B,CA1BtB;;AAAA;AA0BImB,eA1BJ;;AAAA;AAAA,YA4BOA,UAAUd,MAAV,GAAmB,CA5B1B;AAAA;AAAA;AAAA;;AA6BQkB,YA7BR,GA6BiBJ,UAAU,CAAV,CA7BjB;;AAAA,WA8BQD,SA9BR;AAAA;AAAA;AAAA;;AAAA;AAAA,aA+BW/B,QAAQW,IAAR,CAAagB,MAAb,CAAoBS,OAAOhB,EAA3B,EAA+B,EAACE,QAAQS,SAAT,EAA/B,CA/BX;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAmCE;;AAnCF;AAAA;AAAA,aAqCO/B,QAAQC,OAAR,CAAgB0B,MAAhB,CAAuBD,EAAEN,EAAzB,EAA6B,EAACiB,SAAS,IAAV,EAA7B,CArCP;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,E;;iBAAeC,oB;;;;;;uDAwCf,kBAA2CC,MAA3C,EAAmDf,KAAnD;AAAA;AAAA;AAAA;AAAA;AAAA;AAEKgB,gBAFL,GAEkB,KAFlB;;AAGC,UAAID,UAAUA,OAAOE,IAAjB,IAAyBF,OAAOC,UAApC,EAAgD;AAC/CA,oBAAaD,OAAOE,IAApB;AACA;AACGC,WANL,GAMa,SANb;;AAOC,UAAIH,UAAUA,OAAOG,KAArB,EAA4B;AAC3BA,eAAQH,OAAOG,KAAf;AACA;;AAEGC,qBAXL,GAWuB,CAAC,MAAD,EAAS,KAAT,EAAgB,OAAhB,EAAyB,QAAzB,EAAmC,WAAnC,EAAgD,MAAhD,CAXvB;;;AAaC,UAAIC,UAAUC,SAAV,CAAoBC,MAApB,CAA2B,SAA3B,IAAwC,CAAC,CAA7C,EAAgD;AAC/CH,yBAAkB,CAAC,MAAD,EAAS,KAAT,EAAgB,OAAhB,EAAyB,QAAzB,EAAmC,WAAnC,EAAgD,MAAhD,CAAlB;AACA;;AAEGI,kBAjBL,GAiBoB,CAAC,KAAD,EAAQ,QAAR,EAAkB,UAAlB,EAA8B,QAA9B,EAAwC,OAAxC,CAjBpB;;;AAmBC,UAAIH,UAAUC,SAAV,CAAoBC,MAApB,CAA2B,SAA3B,IAAwC,CAAC,CAA7C,EAAgD;AAC/CC,sBAAe,CAAC,KAAD,EAAQ,QAAR,EAAkB,QAAlB,EAA4B,OAA5B,CAAf;AACA;;AAEGC,oBAvBL,GAuBsBC,OAAOC,IAAP,CAAYX,OAAOY,WAAnB,EACnBC,MADmB,CACZ,UAAUC,GAAV,EAAe;AACtB,cAAOV,gBAAgBW,QAAhB,CAAyBD,GAAzB,CAAP;AACA,OAHmB,EAInBE,MAJmB,CAIZ,UAAUC,GAAV,EAAeH,GAAf,EAAoB;AAC3BG,WAAIH,GAAJ,IAAWd,OAAOY,WAAP,CAAmBE,GAAnB,CAAX;AACA,cAAOG,GAAP;AACA,OAPmB,EAOjB,EAPiB,CAvBtB;;;AAgCC,UAAIR,eAAeS,IAAf,GAAsB,CAAtB,IAA2BT,eAAeS,IAAf,GAAsB,GAArD,EAA0DT,eAAeS,IAAf,GAAsB,CAAtB;AAC1D,UAAIT,eAAeU,GAAf,GAAqB,CAArB,IAA0BV,eAAeU,GAAf,GAAqB,GAAnD,EAAwDV,eAAeU,GAAf,GAAqB,CAArB;AACxD,UAAIV,eAAeW,KAAf,GAAuB,GAA3B,EAAgCX,eAAeW,KAAf,GAAuB,GAAvB;AAChC,UAAIX,eAAeY,MAAf,GAAwB,GAA5B,EAAiCZ,eAAeY,MAAf,GAAwB,GAAxB;;AAEjCZ,qBAAea,IAAf,GAAsB,QAAtB;;AArCD;AAAA,aAyCuB7D,QAAQC,OAAR,CAAgBsB,MAAhB,CAAuByB,cAAvB,EAAuCc,KAAvC,CAA6C,UAAUC,KAAV,EAAiB;AACnFC,eAAQD,KAAR,CAAcA,KAAd;AACAC,eAAQC,GAAR,CAAYF,KAAZ;AACAC,eAAQC,GAAR,CAAYF,MAAMG,OAAlB;AACA,OAJqB,CAzCvB;;AAAA;AAyCKC,eAzCL;AA+CKC,cA/CL,GA+CgBD,UAAUxD,IAAV,CAAe,CAAf,EAAkBS,EA/ClC;AAiDUH,OAjDV,GAiDc,CAjDd;;AAAA;AAAA,YAiDiBA,IAAIsB,OAAO5B,IAAP,CAAYO,MAjDjC;AAAA;AAAA;AAAA;;AAkDMkB,YAlDN,GAkDea,OAAOC,IAAP,CAAYX,OAAO5B,IAAP,CAAYM,CAAZ,CAAZ,EACXmC,MADW,CACJ,UAAUC,GAAV,EAAe;AACtB,cAAON,aAAaO,QAAb,CAAsBD,GAAtB,CAAP;AACA,OAHW,EAIXE,MAJW,CAIJ,UAAUC,GAAV,EAAeH,GAAf,EAAoB;AAC3BG,WAAIH,GAAJ,IAAWd,OAAO5B,IAAP,CAAYM,CAAZ,EAAeoC,GAAf,CAAX;AACA,cAAOG,GAAP;AACA,OAPW,EAOT,EAPS,CAlDf;;AAAA,YA2DMhC,SAAS,IAAT,IAAiBA,SAASY,OAAOD,KA3DvC;AAAA;AAAA;AAAA;;AAAA;;AAAA;AA8DEC,aAAOF,QAAP,GAAkBiC,UAAU/C,EAA5B;;AAEA,UAAIwB,UAAUC,SAAV,CAAoBC,MAApB,CAA2B,SAA3B,IAAwC,CAAC,CAA7C,EAAgD;AAC/C,WAAI,CAAC,CAACV,OAAOiC,GAAT,IAAgBjC,OAAOiC,GAAP,CAAWvB,MAAX,CAAkB,QAAlB,IAA8B,CAAC,CAAnD,EAAsD;AACrDkB,gBAAQC,GAAR,CAAY,wBAAZ,EAAsC7B,OAAOiC,GAA7C;AACAjC,eAAOiC,GAAP,GAAa,EAAb;AACA;AACD;AArEH;AAAA;AAAA,aAuE0BrE,QAAQW,IAAR,CAAaY,MAAb,CAAoBa,MAApB,EAA4B0B,KAA5B,CAAkC,UAAUC,KAAV,EAAiB;AACzEC,eAAQD,KAAR,CAAcA,KAAd;AACAC,eAAQC,GAAR,CAAYF,KAAZ;AACAC,eAAQC,GAAR,CAAYF,MAAMG,OAAlB;AACA,OAJsB,CAvE1B;;AAAA;AAuEOI,gBAvEP;AAAA;AAAA;;AAAA;AAAA;AAAA;;AA6EGN,cAAQC,GAAR,CAAY,sBAAZ;AACAD,cAAQD,KAAR;;AA9EH;AAiDyC9C,SAjDzC;AAAA;AAAA;;AAAA;AAAA;AAAA,aAkFOjB,QAAQW,IAAR,CAAa4D,MAAb,CAAoBH,QAApB,EAA8BN,KAA9B,CAAoC,UAAUC,KAAV,EAAiB;AAC1DC,eAAQD,KAAR,CAAcA,KAAd;AACAC,eAAQC,GAAR,CAAYF,KAAZ;AACAC,eAAQC,GAAR,CAAYF,MAAMG,OAAlB;AACA,OAJK,CAlFP;;AAAA;;AAwFC,UAAI1B,UAAJ,EAAgB;AACfwB,eAAQC,GAAR,CAAY,cAAZ;AACAO,qBAAcL,UAAU/C,EAAxB,EAA4BoB,UAA5B;AACA;;AAED,UAAIE,SAAS,SAAb,EAAwB;AACvBsB,eAAQC,GAAR,CAAY,eAAZ;AACAQ,sBAAeN,UAAU/C,EAAzB,EAA6BsB,KAA7B;AACA;;AAhGF;AAAA,aAkGO1C,QAAQC,OAAR,CAAgB0B,MAAhB,CAAuBwC,UAAU/C,EAAjC,EAAqC,EAACiB,SAAS,IAAV,EAArC,CAlGP;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,E;;iBAAeqC,2B;;;;;;uDAyGf,kBAA6BxC,QAA7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aACOlC,QAAQC,OAAR,CAAgB0B,MAAhB,CAAuBO,QAAvB,EAAiC,EAACG,SAAS,IAAV,EAAjC,CADP;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,E;;iBAAesC,a;;;;;;uDAIf,kBAA2BzC,QAA3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YACKU,UAAUC,SAAV,CAAoBC,MAApB,CAA2B,SAA3B,IAAwC,CAAC,CAD9C;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA,YAKK,CAACZ,QAAD,IAAaA,WAAW,CAL7B;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA,aAQ0B0C,gBAAgB,aAAhB,EAA+B,KAA/B,CAR1B;;AAAA;AAQMC,iBARN;;AAAA,UASOA,WATP;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA,aAWqB7E,QAAQ8E,WAAR,CAAoBC,QAApB,CAA6B,EAACD,aAAa,CAAC,gBAAD,CAAd,EAA7B,CAXrB;;AAAA;AAWME,YAXN;;AAYE,UAAIA,MAAJ,EAAY;AAEXC,cAAOC,MAAP,CAAcC,OAAd,CAAsBC,OAAtB,CAA8B;AAAA,gFAAgBlD,QAAhB,EAA0BmD,cAA1B;AAAA;;AAAA;AAAA;AAAA;AAAA;AAC7BC,iCAAoB,EAApB;AACIC,sCAFyB,GAEG,IAFH;AAGzBC,8BAHyB,GAGL,KAHK;AAIzBC,2BAJyB,GAIRC,SAJQ;AAAA;;AAM5B,kBAASC,SAAT,GAAqBN,eAAeO,OAAOC,QAAtB,GAArB,EAA+D,EAAEN,4BAA4B,CAACO,QAAQH,UAAUI,IAAV,EAAT,EAA2BC,IAAzD,CAA/D,EAA+HT,4BAA4B,IAA3J,EAAiK;AAC5JU,2BAD4J,GAC5IH,MAAMI,KADsI;;AAEhKZ,gCAAkBnE,IAAlB,CAAuB8E,cAAcE,MAArC;AACA;AAT2B;AAAA;;AAAA;AAAA;AAAA;;AAW5BX,iCAAoB,IAApB;AACAC;;AAZ4B;AAAA;AAAA;;AAe3B,iBAAI,CAACF,yBAAD,IAA8BI,UAAUS,MAA5C,EAAoD;AACnDT,wBAAUS,MAAV;AACA;;AAjB0B;AAAA;;AAAA,kBAmBvBZ,iBAnBuB;AAAA;AAAA;AAAA;;AAAA,mBAoBpBC,cApBoB;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA,oBAwBTzF,QAAQC,OAAR,CAAgBoG,MAAhB,CAAuB,EAACC,UAAU,IAAX,EAAvB,CAxBS;;AAAA;AAwBzBrG,oBAxByB;AAyBzBsG,oBAzByB,GAyBf,CAAC,CAzBc;;AA0B7B,kBAAStF,CAAT,GAAahB,QAAQiB,MAAR,GAAiB,CAA9B,EAAiCD,KAAK,CAAtC,EAAyCA,GAAzC,EAA8C;AAC7C,kBAAIhB,QAAQgB,CAAR,EAAWG,EAAX,IAAiBc,QAArB,EAA+B;AAC9B,oBAASsE,CAAT,IAAclB,iBAAd,EAAiC;AAC5BN,sBAD4B,GACnByB,aAAaxG,QAAQgB,CAAR,CAAb,EAAyBqE,kBAAkBkB,CAAlB,CAAzB,CADmB;;AAEhC,oBAAIxB,MAAJ,EAAY;AACXuB,2BAAUC,CAAV;AACA;AACD;AACD;AACD;AACD;;AAESvF,cAtCoB,GAsChBhB,QAAQiB,MAAR,GAAiB,CAtCD;;AAAA;AAAA,mBAsCID,KAAK,CAtCT;AAAA;AAAA;AAAA;;AAAA,mBAuCxBhB,QAAQgB,CAAR,EAAWG,EAAX,IAAiBc,QAvCO;AAAA;AAAA;AAAA;;AAAA,kBAwCvBuE,aAAaxG,QAAQgB,CAAR,CAAb,EAAyBqE,kBAAkBiB,OAAlB,CAAzB,CAxCuB;AAAA;AAAA;AAAA;;AAAA;AAAA,oBAyCpBvG,QAAQC,OAAR,CAAgB0B,MAAhB,CAAuB1B,QAAQgB,CAAR,EAAWG,EAAlC,EAAsC,EAAC,SAAS,WAAV,EAAtC,CAzCoB;;AAAA;AAsCYH,gBAtCZ;AAAA;AAAA;;AAAA;AA6C7B;;AA7C6B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA,WA8C5ByF,IA9C4B,CA8CvB,IA9CuB,EA8CjBxE,QA9CiB,CAA9B;AA+CA;;AA7DH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,E;;iBAAe2C,W;;;;;;uDAiEf,kBAA4B3C,QAA5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YACKA,WAAW,CADhB;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAGKjC,aAHL,GAGe,EAHf;AAAA;AAAA,aAIuB2E,gBAAgB,WAAhB,EAA6B,EAA7B,CAJvB;;AAAA;AAIK+B,eAJL;;AAKC,UAAIA,qBAAqBC,KAAzB,EAAgC3G,UAAU0G,SAAV;;AAEhC,UAAI1G,QAAQ4G,OAAR,CAAgB3E,QAAhB,IAA4B,CAAC,CAAjC,EAAoCjC,QAAQ6G,MAAR,CAAe7G,QAAQ4G,OAAR,CAAgB3E,QAAhB,CAAf,EAA0C,CAA1C;AACpCjC,cAAQ8G,OAAR,CAAgB7E,QAAhB;AARD;AAAA,aASO8E,gBAAgB,WAAhB,EAA6B/G,OAA7B,CATP;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,E;;iBAAegH,Y;;;;;;uDA0Bf,kBAA2B/E,QAA3B;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,UAEO,CAACA,QAFR;AAAA;AAAA;AAAA;;AAAA;AAAA,aAGS+E,aAAa/E,QAAb,CAHT;;AAAA;AAAA;AAAA,aAKS2C,YAAY3C,QAAZ,CALT;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,E;;iBAAe9B,W;;;;;;uDAYf,kBAA6BmC,MAA7B;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,YAEM,CAAC,CAACA,MAAF,IAAY,CAAC,CAACA,OAAOnB,EAF3B;AAAA;AAAA;AAAA;;AAAA;AAAA,aAGS6F,aAAa1E,OAAOnB,EAApB,CAHT;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AASC8F,iBAAWC,eAAX,EAA4B,GAA5B;;AATD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,E;;iBAAe7G,a;;;;;;wDAYf,mBAA6B4B,QAA7B;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,UAEO,CAACA,QAFR;AAAA;AAAA;AAAA;;AAAA;AAAA,aAGS+E,aAAa/E,QAAb,CAHT;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,E;;iBAAe1B,a;;;;;;wDAWf,mBAA2B0B,QAA3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UACMA,QADN;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA,aAGqBlC,QAAQoH,OAAR,CAAgBC,KAAhB,CAAsBxF,GAAtB,CAA0B,CAAC,aAAD,EAAgB,cAAhB,EAAgC,cAAhC,CAA1B,CAHrB;;AAAA;AAGKuF,aAHL;AAKKE,WALL,GAKaF,QAAQG,WAAR,IAAuB,EALpC;AAMKC,YANL,GAMcJ,QAAQK,YAAR,IAAwB,EANtC;AAOKC,YAPL,GAOcN,QAAQO,YAAR,IAAwB,EAPtC;;AAAA,YASK,CAACL,MAAMpF,QAAN,CAAD,IAAoB,CAACsF,OAAOtF,QAAP,CAT1B;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA,aAYqBlC,QAAQC,OAAR,CAAgB4B,GAAhB,CAAoBK,QAApB,EAA8B,EAACoE,UAAU,IAAX,EAA9B,CAZrB;;AAAA;AAYM/D,YAZN;AAcMqF,aAdN,GAcgBC,SAAStF,MAAT,CAdhB;;AAeEmF,aAAOxF,QAAP,IAAmB0F,OAAnB;AAfF;AAAA,aAgBQZ,gBAAgB,cAAhB,EAAgCU,MAAhC,CAhBR;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAkBE1D,cAAQC,GAAR;;AAlBF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,E;;iBAAe6D,W;;;;;;;AA/Rd,IAAI9H,UAAUA,WAAWiF,MAAzB;;AAyJD,SAAS8C,oBAAT,CAA8B7F,QAA9B,EAAwC;AACvCgF,YAAWvC,cAAc+B,IAAd,CAAmB,IAAnB,EAAyBxE,QAAzB,CAAX,EAA+C,GAA/C;AACA;;AA0JD,SAAS2F,QAAT,CAAkBtF,MAAlB,EAA0B;AACzB,KAAIyF,OAAO,EAAX;AACA,MAAK,IAAI/G,IAAI,CAAb,EAAgBA,IAAIsB,OAAO5B,IAAP,CAAYO,MAAhC,EAAwCD,GAAxC,EAA6C;AAC5C,MAAI,CAACsB,OAAO5B,IAAP,CAAYM,CAAZ,EAAeoD,GAApB,EAAyB;AACzB2D,OAAK7G,IAAL,CAAUoB,OAAO5B,IAAP,CAAYM,CAAZ,EAAeoD,GAAzB;AACA;AACD2D,MAAKC,IAAL;;AAEA,KAAIC,OAAO,CAAX;AACA,MAAK,IAAIjH,IAAI,CAAb,EAAgBA,IAAI+G,KAAK9G,MAAzB,EAAiCD,GAAjC,EAAsC;AACrC,MAAIkH,OAAOC,eAAeJ,KAAK/G,CAAL,CAAf,CAAX;AACAiH,SAAQ,CAACA,QAAQ,CAAT,IAAcA,IAAf,GAAuBC,IAA9B;AACAD,SAAOA,OAAOA,IAAd;AACA;AACD,QAAOA,IAAP;AACA","file":"windows.js","sourcesContent":["﻿var browser = browser || chrome;\r\n\r\nasync function setupWindowListeners() {\r\n\tbrowser.windows.onFocusChanged.removeListener(windowFocus);\r\n\tbrowser.windows.onCreated.removeListener(windowCreated);\r\n\tbrowser.windows.onRemoved.removeListener(windowRemoved);\r\n\r\n\tbrowser.windows.onFocusChanged.addListener(windowFocus);\r\n\tbrowser.windows.onCreated.addListener(windowCreated);\r\n\tbrowser.windows.onRemoved.addListener(windowRemoved);\r\n}\r\n\r\nasync function createWindowWithTabs(tabs, isIncognito) {\r\n\tvar pinnedIndex = 0;\r\n\tvar firstTab = tabs.shift();\r\n\tvar t = [];\r\n\tfor (var i = 0; i < tabs.length; i++) {\r\n\t\tt.push(tabs[i].id);\r\n\t}\r\n\t;\r\n\r\n\tvar firstPinned = firstTab.pinned;\r\n\tvar w = await browser.windows.create({tabId: firstTab.id, incognito: !!isIncognito});\r\n\tif (firstPinned) {\r\n\t\tawait browser.tabs.update(w.tabs[0].id, {pinned: firstPinned});\r\n\t\tpinnedIndex++;\r\n\t}\r\n\r\n\tif (t.length > 0) {\r\n\t\tvar i = 0;\r\n\t\tfor (var oldTabId of t) {\r\n\t\t\ti++;\r\n\t\t\tvar oldTab = await browser.tabs.get(oldTabId);\r\n\t\t\tvar tabPinned = oldTab.pinned;\r\n\t\t\tvar movedTabs = [];\r\n\t\t\tif (!tabPinned) {\r\n\t\t\t\tmovedTabs = await browser.tabs.move(oldTabId, {windowId: w.id, index: -1});\r\n\t\t\t} else {\r\n\t\t\t\tmovedTabs = await browser.tabs.move(oldTabId, {windowId: w.id, index: pinnedIndex++});\r\n\t\t\t}\r\n\t\t\tif (movedTabs.length > 0) {\r\n\t\t\t\tvar newTab = movedTabs[0];\r\n\t\t\t\tif (tabPinned) {\r\n\t\t\t\t\tawait browser.tabs.update(newTab.id, {pinned: tabPinned});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t;\r\n\t}\r\n\tawait browser.windows.update(w.id, {focused: true});\r\n}\r\n\r\nasync function createWindowWithSessionTabs(window, tabId) {\r\n\r\n\tvar customName = false;\r\n\tif (window && window.name && window.customName) {\r\n\t\tcustomName = window.name;\r\n\t}\r\n\tvar color = \"default\";\r\n\tif (window && window.color) {\r\n\t\tcolor = window.color;\r\n\t}\r\n\r\n\tvar whitelistWindow = [\"left\", \"top\", \"width\", \"height\", \"incognito\", \"type\"];\r\n\r\n\tif (navigator.userAgent.search(\"Firefox\") > -1) {\r\n\t\twhitelistWindow = [\"left\", \"top\", \"width\", \"height\", \"incognito\", \"type\"];\r\n\t}\r\n\r\n\tvar whitelistTab = [\"url\", \"active\", \"selected\", \"pinned\", \"index\"];\r\n\r\n\tif (navigator.userAgent.search(\"Firefox\") > -1) {\r\n\t\twhitelistTab = [\"url\", \"active\", \"pinned\", \"index\"];\r\n\t}\r\n\r\n\tvar filteredWindow = Object.keys(window.windowsInfo)\r\n\t\t.filter(function (key) {\r\n\t\t\treturn whitelistWindow.includes(key);\r\n\t\t})\r\n\t\t.reduce(function (obj, key) {\r\n\t\t\tobj[key] = window.windowsInfo[key];\r\n\t\t\treturn obj;\r\n\t\t}, {});\r\n\r\n\tif (filteredWindow.left < 0 || filteredWindow.left > 800) filteredWindow.left = 0;\r\n\tif (filteredWindow.top < 0 || filteredWindow.top > 600) filteredWindow.top = 0;\r\n\tif (filteredWindow.width > 800) filteredWindow.width = 800;\r\n\tif (filteredWindow.height > 600) filteredWindow.height = 600;\r\n\r\n\tfilteredWindow.type = \"normal\";\r\n\r\n\t// console.log(\"filtered window\", filteredWindow);\r\n\r\n\tvar newWindow = await browser.windows.create(filteredWindow).catch(function (error) {\r\n\t\tconsole.error(error);\r\n\t\tconsole.log(error);\r\n\t\tconsole.log(error.message);\r\n\t});\r\n\r\n\tvar emptyTab = newWindow.tabs[0].id;\r\n\r\n\tfor (var i = 0; i < window.tabs.length; i++) {\r\n\t\tvar newTab = Object.keys(window.tabs[i])\r\n\t\t\t.filter(function (key) {\r\n\t\t\t\treturn whitelistTab.includes(key);\r\n\t\t\t})\r\n\t\t\t.reduce(function (obj, key) {\r\n\t\t\t\tobj[key] = window.tabs[i][key];\r\n\t\t\t\treturn obj;\r\n\t\t\t}, {});\r\n\r\n\t\tif (tabId != null && tabId != newTab.index) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tnewTab.windowId = newWindow.id;\r\n\r\n\t\tif (navigator.userAgent.search(\"Firefox\") > -1) {\r\n\t\t\tif (!!newTab.url && newTab.url.search(\"about:\") > -1) {\r\n\t\t\t\tconsole.log(\"filtered by about: url\", newTab.url);\r\n\t\t\t\tnewTab.url = \"\";\r\n\t\t\t}\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tvar tabCreated = await browser.tabs.create(newTab).catch(function (error) {\r\n\t\t\t\tconsole.error(error);\r\n\t\t\t\tconsole.log(error);\r\n\t\t\t\tconsole.log(error.message);\r\n\t\t\t});\r\n\t\t} catch (e) {\r\n\t\t\tconsole.log(\"couldn't restore tab\");\r\n\t\t\tconsole.error(e);\r\n\t\t}\r\n\t}\r\n\r\n\tawait browser.tabs.remove(emptyTab).catch(function (error) {\r\n\t\tconsole.error(error);\r\n\t\tconsole.log(error);\r\n\t\tconsole.log(error.message);\r\n\t});\r\n\r\n\tif (customName) {\r\n\t\tconsole.log(\"setting name\");\r\n\t\tsetWindowName(newWindow.id, customName);\r\n\t}\r\n\r\n\tif (color != \"default\") {\r\n\t\tconsole.log(\"setting color\");\r\n\t\tsetWindowColor(newWindow.id, color);\r\n\t}\r\n\r\n\tawait browser.windows.update(newWindow.id, {focused: true});\r\n}\r\n\r\nfunction focusOnWindowDelayed(windowId) {\r\n\tsetTimeout(focusOnWindow.bind(this, windowId), 125);\r\n}\r\n\r\nasync function focusOnWindow(windowId) {\r\n\tawait browser.windows.update(windowId, {focused: true});\r\n}\r\n\r\nasync function hideWindows(windowId) {\r\n\tif (navigator.userAgent.search(\"Firefox\") > -1) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (!windowId || windowId < 0) {\r\n\t\treturn;\r\n\t} else {\r\n\t\tvar hideWindows = await getLocalStorage(\"hideWindows\", false);\r\n\t\tif (!hideWindows) return;\r\n\r\n\t\tvar result = await browser.permissions.contains({permissions: ['system.display']});\r\n\t\tif (result) {\r\n\t\t\t// The extension has the permissions.\r\n\t\t\tchrome.system.display.getInfo(async function (windowId, displaylayouts) {\r\n\t\t\t\tglobalDisplayInfo = [];\r\n\t\t\t\tvar _iteratorNormalCompletion = true;\r\n\t\t\t\tvar _didIteratorError = false;\r\n\t\t\t\tvar _iteratorError = undefined;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tfor (var _iterator = displaylayouts[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\r\n\t\t\t\t\t\tvar displaylayout = _step.value;\r\n\t\t\t\t\t\tglobalDisplayInfo.push(displaylayout.bounds);\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\t_didIteratorError = true;\r\n\t\t\t\t\t_iteratorError = err;\r\n\t\t\t\t} finally {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tif (!_iteratorNormalCompletion && _iterator.return) {\r\n\t\t\t\t\t\t\t_iterator.return();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} finally {\r\n\t\t\t\t\t\tif (_didIteratorError) {\r\n\t\t\t\t\t\t\tthrow _iteratorError;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tvar windows = await browser.windows.getAll({populate: true});\r\n\t\t\t\tvar monitor = -1;\r\n\t\t\t\tfor (var i = windows.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tif (windows[i].id == windowId) {\r\n\t\t\t\t\t\tfor (var a in globalDisplayInfo) {\r\n\t\t\t\t\t\t\tvar result = is_in_bounds(windows[i], globalDisplayInfo[a]);\r\n\t\t\t\t\t\t\tif (result) {\r\n\t\t\t\t\t\t\t\tmonitor = a;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t;\r\n\r\n\t\t\t\tfor (var i = windows.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tif (windows[i].id != windowId) {\r\n\t\t\t\t\t\tif (is_in_bounds(windows[i], globalDisplayInfo[monitor])) {\r\n\t\t\t\t\t\t\tawait browser.windows.update(windows[i].id, {\"state\": \"minimized\"});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t;\r\n\t\t\t}.bind(null, windowId));\r\n\t\t}\r\n\t}\r\n}\r\n\r\nasync function windowActive(windowId) {\r\n\tif (windowId < 0) return;\r\n\r\n\tvar windows = [];\r\n\tvar windowAge = await getLocalStorage(\"windowAge\", []);\r\n\tif (windowAge instanceof Array) windows = windowAge;\r\n\r\n\tif (windows.indexOf(windowId) > -1) windows.splice(windows.indexOf(windowId), 1);\r\n\twindows.unshift(windowId);\r\n\tawait setLocalStorage(\"windowAge\", windows);\r\n\r\n\t// browser.windows.getLastFocused({ populate: true }, function (w) {\r\n\t// \tfor (var i = 0; i < w.tabs.length; i++) {\r\n\t// \t\tvar tab = w.tabs[i];\r\n\t// \t\tif (tab.active == true) {\r\n\t// \t\t\t// console.log(\"get last focused\", tab.id);\r\n\t// \t\t\t// tabActiveChanged({\r\n\t// \t\t\t// \ttabId: tab.id,\r\n\t// \t\t\t// \twindowId: tab.windowId\r\n\t// \t\t\t// });\r\n\t// \t\t}\r\n\t// \t};\r\n\t// });\r\n\t// console.log(windows);\r\n}\r\n\r\nasync function windowFocus(windowId) {\r\n\ttry {\r\n\t\tif (!!windowId) {\r\n\t\t\tawait windowActive(windowId);\r\n\t\t\t// console.log(\"onFocused\", windowId);\r\n\t\t\tawait hideWindows(windowId);\r\n\t\t}\r\n\t} catch (e) {\r\n\r\n\t}\r\n}\r\n\r\nasync function windowCreated(window) {\r\n\ttry {\r\n\t\tif (!!window && !!window.id) {\r\n\t\t\tawait windowActive(window.id);\r\n\t\t}\r\n\t} catch (e) {\r\n\r\n\t}\r\n\t// console.log(\"onCreated \" + window.id, window);\r\n\tsetTimeout(cleanupDebounce, 250);\r\n}\r\n\r\nasync function windowRemoved(windowId) {\r\n\ttry {\r\n\t\tif (!!windowId) {\r\n\t\t\tawait windowActive(windowId);\r\n\t\t}\r\n\t} catch (e) {\r\n\r\n\t}\r\n\t// console.log(\"onRemoved\", windowId);\r\n}\r\n\r\nasync function checkWindow(windowId) {\r\n\tif (!windowId) return;\r\n\r\n\tvar storage = await browser.storage.local.get(['windowNames', 'windowColors', 'windowHashes']);\r\n\r\n\tvar names = storage.windowNames || {};\r\n\tvar colors = storage.windowColors || {};\r\n\tvar hashes = storage.windowHashes || {};\r\n\r\n\tif (!names[windowId] && !colors[windowId]) return;\r\n\r\n\ttry {\r\n\t\tvar window = await browser.windows.get(windowId, {populate: true});\r\n\r\n\t\tvar newHash = hashcode(window);\r\n\t\thashes[windowId] = newHash;\r\n\t\tawait setLocalStorage('windowHashes', hashes);\r\n\t} catch (e) {\r\n\t\tconsole.log(e);\r\n\t}\r\n}\r\n\r\nfunction hashcode(window) {\r\n\tvar urls = [];\r\n\tfor (var i = 0; i < window.tabs.length; i++) {\r\n\t\tif (!window.tabs[i].url) continue;\r\n\t\turls.push(window.tabs[i].url);\r\n\t}\r\n\turls.sort();\r\n\r\n\tvar hash = 0;\r\n\tfor (var i = 0; i < urls.length; i++) {\r\n\t\tvar code = stringHashcode(urls[i]);\r\n\t\thash = ((hash << 5) - hash) + code;\r\n\t\thash = hash & hash; // Convert to 32bit integer\r\n\t}\r\n\treturn hash;\r\n}"]}