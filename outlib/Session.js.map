{"version":3,"sources":["../lib/Session.jsx"],"names":["Session","props","name","window","color","state","windowTitles","tabs","stop","bind","windowClick","windowTabClick","close","openTab","maximize","_this","hideWindow","titleAdded","tabsperrow","layout","indexOf","Math","ceil","sqrt","length","map","tab","tabId","id","isHidden","hiddenTabs","filterTabs","isSelected","selection","index","tabMiddleClick","hoverHandler","searchActive","select","tabactions","push","hoverIcon","unshift","children","shift","j","focused","windowsInfo","lastOpenWindow","incognito","nextProps","nextState","e","stopPropagation","restoreSession","console","log","_this2","browser","runtime","sendMessage","command","tab_id","parentUpdate","inPopup","setTimeout","scrollTo","windows","WINDOW_ID_CURRENT","getLocalStorage","sessions","setLocalStorage","catch","err","error","message","value","React","Component"],"mappings":"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","file":"Session.js","sourcesContent":["\"use strict\";\n\nclass Session extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\t//console.log(this.props.window);\n\t\t//console.log(this.props.window.name);\n\t\tvar name = this.props.window.name;\n\t\tvar color = this.props.window.color || \"default\";\n\t\tthis.state = {\n\t\t\twindowTitles: [],\n\t\t\tname: name,\n\t\t\tcolor: color,\n\t\t\ttabs: 0\n\t\t};\n\n\t\tthis.stop = this.stop.bind(this);\n\t\tthis.windowClick = this.windowClick.bind(this);\n\t\tthis.windowTabClick = this.windowTabClick.bind(this);\n\t\tthis.close = this.close.bind(this);\n\t\tthis.openTab = this.openTab.bind(this);\n\t\tthis.maximize = this.maximize.bind(this);\n\n\t}\n\trender() {\n\t\tvar _this = this;\n\t\tvar name = this.state.name;\n\t\tvar color = this.state.color;\n\t\tvar hideWindow = true;\n\t\tvar titleAdded = false;\n\t\tvar tabsperrow = this.props.layout.indexOf(\"blocks\") > -1 ? Math.ceil(Math.sqrt(this.props.tabs.length + 2)) : this.props.layout == \"vertical\" ? 1 : 15;\n\t\tvar tabs = this.props.tabs.map(function(tab) {\n\t\t\tvar tabId = tab.id * tab.id * tab.id * 100;\n\t\t\tvar isHidden = !!_this.props.hiddenTabs[tabId] && _this.props.filterTabs;\n\t\t\tvar isSelected = !!_this.props.selection[tabId];\n\t\t\ttab.id = tab.index;\n\t\t\thideWindow &= isHidden;\n\t\t\treturn (\n\t\t\t\t<Tab\n\t\t\t\t\tid={\"sessiontab_\" + _this.props.window.id + \"_\" + tab.index}\n\t\t\t\t\tkey={\"sessiontab_\" + _this.props.window.id + \"_\" + tab.index}\n\t\t\t\t\twindow={_this.props.window}\n\t\t\t\t\tlayout={_this.props.layout}\n\t\t\t\t\ttab={tab}\n\t\t\t\t\tselected={isSelected}\n\t\t\t\t\thidden={isHidden}\n\t\t\t\t\tdraggable={false}\n\t\t\t\t\tclick={_this.openTab}\n\t\t\t\t\tmiddleClick={_this.props.tabMiddleClick}\n\t\t\t\t\thoverHandler={_this.props.hoverHandler}\n\t\t\t\t\tsearchActive={_this.props.searchActive}\n\t\t\t\t\tselect={_this.props.select}\n\t\t\t\t\tref={\"sessiontab\" + tabId}\n\t\t\t\t/>\n\t\t\t);\n\t\t});\n\t\tif (!hideWindow) {\n\t\t\tif (!!this.props.tabactions) {\n\t\t\t\ttabs.push(\n\t\t\t\t\t<div key={\"sessionnl_\" + _this.props.window.id} className=\"newliner\" />,\n\t\t\t\t\t<div key={\"sessionwa_\" + _this.props.window.id} className=\"window-actions\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName={\"icon tabaction restore \" + (this.props.layout.indexOf(\"blocks\") > -1 ? \"\" : \"windowaction\")}\n\t\t\t\t\t\t\ttitle={\"Restore this saved window\\nWill restore \" + tabs.length + \" tabs. Please note : The tabs will be restored without their history.\"}\n\t\t\t\t\t\t\tonClick={this.windowClick}\n\t\t\t\t\t\t\tonMouseEnter={this.props.hoverIcon}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName={\"icon tabaction delete \" + (this.props.layout.indexOf(\"blocks\") > -1 ? \"\" : \"windowaction\")}\n\t\t\t\t\t\t\ttitle={\"Delete this saved window\\nWill delete \" + tabs.length + \" tabs permanently\"}\n\t\t\t\t\t\t\tonClick={this.close}\n\t\t\t\t\t\t\tonMouseEnter={this.props.hoverIcon}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (this.props.windowTitles) {\n\t\t\t\tif (name) {\n\t\t\t\t\ttabs.unshift(\n\t\t\t\t\t\t<h3 key={\"session-\" + this.props.window.id + \"-windowTitle\"} className=\"center windowTitle\">\n\t\t\t\t\t\t\t{name}\n\t\t\t\t\t\t</h3>\n\t\t\t\t\t);\n\t\t\t\t\ttitleAdded = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (tabsperrow < 3) {\n\t\t\t\ttabsperrow = 3;\n\t\t\t}\n\t\t\tvar children = [];\n\t\t\tif (!!titleAdded) {\n\t\t\t\tchildren.push(tabs.shift());\n\t\t\t}\n\t\t\tfor (var j = 0; j < tabs.length; j++) {\n\t\t\t\tchildren.push(tabs[j]);\n\t\t\t\tif ((j + 1) % tabsperrow == 0 && j && this.props.layout.indexOf(\"blocks\") > -1) {\n\t\t\t\t\tchildren.push(<div key={\"sessionnl_\" + _this.props.window.id + \"_\" + j} className=\"newliner\" />);\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar focused = false;\n\t\t\tif (this.props.window.windowsInfo.focused || this.props.lastOpenWindow == this.props.window.windowsInfo.id) {\n\t\t\t\tfocused = true;\n\t\t\t}\n\t\t\treturn (\n\t\t\t\t<div\n\t\t\t\t\tkey={\"session-\" + this.props.window.id}\n\t\t\t\t\tid={\"session-\" + this.props.window.id}\n\t\t\t\t\tclassName={\n\t\t\t\t\t\t\"window \" +\n\t\t\t\t\t\tthis.props.window.windowsInfo.state +\n\t\t\t\t\t\t\" \" +\n\t\t\t\t\t\t(focused ? \"activeWindow\" : \"\") +\n\t\t\t\t\t\t\" session \" +\n\t\t\t\t\t\t(this.props.layout.indexOf(\"blocks\") > -1 ? \"block\" : \"\") +\n\t\t\t\t\t\t\" \" +\n\t\t\t\t\t\tthis.props.layout +\n\t\t\t\t\t\t\" \" +\n\t\t\t\t\t\tthis.state.color +\n\t\t\t\t\t\t\" \" +\n\t\t\t\t\t\t(this.props.window.windowsInfo.incognito ? \" incognito\" : \"\") +\n\t\t\t\t\t\t\" \" +\n\t\t\t\t\t\t(focused ? \" focused\" : \"\")\n\t\t\t\t\t}\n\t\t\t\t\tonClick={this.windowClick}\n\t\t\t\t>\n\t\t\t\t\t<div className=\"windowcontainer\">{children}</div>\n\t\t\t\t</div>\n\t\t\t);\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\tshouldComponentUpdate(nextProps, nextState) {\n\t\t//console.log(\"should update?\", nextProps, nextState);\n\t\treturn true;\n\t}\n\tstop(e) {\n\t\te.stopPropagation();\n\t}\n\tasync windowTabClick(e) {\n\t\te.stopPropagation();\n\t}\n\tasync windowClick(e) {\n\t\tthis.restoreSession(e, null);\n\t}\n\tasync openTab(e, index) {\n\t\tconsole.log(index);\n\t\tthis.restoreSession(e, index);\n\t}\n\tasync restoreSession(e, tabId) {\n\t\tvar _this2 = this;\n\t\te.stopPropagation();\n\t\tconsole.log(\"source window\", this.props.window);\n\t\t// chrome.runtime.getBackgroundPage(function callback(tabs, backgroundPage) {\n\t\t// \tbackgroundPage.createWindowWithTabs(tabs);\n\t\t// }.bind(null, this.props.window.tabs));\n\n\t\tbrowser.runtime.sendMessage({command: \"create_window_with_session_tabs\", window: this.props.window, tab_id: tabId});\n\n\n\n\t\tthis.props.parentUpdate();\n\n\t\tif (!!window.inPopup) {\n\t\t\twindow.close();\n\t\t}else{\n\t\t\tsetTimeout(function() {\n\t\t\t\tthis.props.scrollTo(\"window\", browser.windows.WINDOW_ID_CURRENT);\n\t\t\t}.bind(this), 500);\n\t\t}\n\n\t\t// , function (tabs, w) {\n\t\t// \tbrowser.tabs.create(first.id, { pinned: first.pinned });\n\t\t// \tif (t.length > 0) {\n\t\t// \t\tbrowser.tabs.move(t, { windowId: w.id, index: -1 }, function (tab) {\n\t\t// \t\t\tbrowser.tabs.update(tab.id, { pinned: tab.pinned });\n\t\t// \t\t});\n\t\t// \t}\n\t\t// \tbrowser.windows.update(w.id, { focused: true });\n\t\t// }.bind(null, this.props.window.tabs));\n\t\t// browser.windows.update(this.props.window.windowsInfo.id, {\n\t\t// \t\"focused\": true },\n\t\t// function (a) {this.props.parentUpdate();}.bind(this));\n\t}\n\tasync close(e) {\n\t\te.stopPropagation();\n\n\t\tvar sessions = await getLocalStorage('sessions', {});\n\t\tdelete sessions[this.props.window.id];\n\n\t\tvar value = await setLocalStorage('sessions', sessions).catch(function (err) {\n\t\t\tconsole.log(err);\n\t\t\tconsole.error(err.message);\n\t\t});\n\n\t\tconsole.log(value);\n\t\tthis.props.parentUpdate();\n\t\t// browser.windows.remove(this.props.window.windowsInfo.id);\n\t}\n\tmaximize(e) {\n\t\te.stopPropagation();\n\t\t// browser.windows.update(this.props.window.windowsInfo.id, {\n\t\t// \t\"state\": \"normal\" },\n\t\t// function (a) {this.props.parentUpdate();}.bind(this));\n\t}\n}\n"]}